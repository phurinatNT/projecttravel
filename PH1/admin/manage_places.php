<?php require '../includes/auth.php'; require '../includes/db.php'; require '../includes/header.php'; if($_SESSION['role']!=='admin'){ header('Location: dashboard.php'); exit(); } if($_SERVER['REQUEST_METHOD']==='POST' && isset($_POST['add'])){ $name=$_POST['name']; $type=(int)$_POST['type_id']; $desc=$_POST['description']; $addr=$_POST['address']; $lat=$_POST['latitude']; $lng=$_POST['longitude']; $img=$_POST['image']?:'assets/img/place1.jpg'; $stmt=$conn->prepare('INSERT INTO places (type_id,name,description,address,latitude,longitude,image) VALUES (?,?,?,?,?,?,?)'); $stmt->bind_param('isssdds',$type,$name,$desc,$addr,$lat,$lng,$img); $stmt->execute(); } if(isset($_GET['delete'])){ $id=(int)$_GET['delete']; $s=$conn->prepare('DELETE FROM places WHERE id=?'); $s->bind_param('i',$id); $s->execute(); } $types=$conn->query('SELECT * FROM place_types'); $places=$conn->query('SELECT p.*,t.name as type_name FROM places p LEFT JOIN place_types t ON p.type_id=t.id'); ?>
<div class="card"><h3>จัดการสถานที่</h3><form method="post" style="display:grid;grid-template-columns:1fr 1fr;gap:8px"><input name="name" placeholder="ชื่อสถานที่" required><select name="type_id"><?php while($t=$types->fetch_assoc()){ echo '<option value="'.$t['id'].'">'.e($t['name']).'</option>'; } ?></select><input name="address" placeholder="ที่อยู่"><input name="image" placeholder="path to image"><input name="latitude" placeholder="latitude"><input name="longitude" placeholder="longitude"><textarea name="description" placeholder="รายละเอียด" style="grid-column:1/3"></textarea><div style="grid-column:1/3"><button class="btn" name="add" type="submit">เพิ่มสถานที่</button></div></form><hr><h4>รายการ</h4><?php while($p=$places->fetch_assoc()){ echo '<div class="list-item"><img src="'.e($p['image']?:'assets/img/place1.jpg').'">'; echo '<div><strong>'.e($p['name']).'</strong><br><small>'.e($p['type_name']).'</small><br><a href="?delete='.$p['id'].'" onclick="return confirm(\'ลบ?\')">ลบ</a></div></div>'; } ?></div><?php require '../includes/footer.php'; ?>