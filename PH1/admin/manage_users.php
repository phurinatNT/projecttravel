<?php require '../includes/auth.php'; require '../includes/db.php'; require '../includes/header.php'; if($_SESSION['role']!=='admin'){ header('Location: dashboard.php'); exit(); } if(isset($_GET['delete'])){ $id=(int)$_GET['delete']; $st=$conn->prepare('SELECT username FROM users WHERE id=? LIMIT 1'); $st->bind_param('i',$id); $st->execute(); $r=$st->get_result()->fetch_assoc(); if($r && $r['username']!=='admin'){ $d=$conn->prepare('DELETE FROM users WHERE id=?'); $d->bind_param('i',$id); $d->execute(); } } $res=$conn->query('SELECT id,username,role FROM users'); ?>
<div class="card"><h3>จัดการผู้ใช้</h3><table style="width:100%;border-collapse:collapse"><tr><th>ID</th><th>username</th><th>role</th><th>จัดการ</th></tr><?php while($u=$res->fetch_assoc()){ echo '<tr style="border-top:1px solid #eee"><td>'.e($u['id']).'</td><td>'.e($u['username']).'</td><td>'.e($u['role']).'</td><td>'; if($u['username']!=='admin') echo '<a href="?delete='.$u['id'].'" onclick="return confirm(\'ลบผู้ใช้?\')">ลบ</a>'; echo '</td></tr>'; } ?></table></div><?php require '../includes/footer.php'; ?>